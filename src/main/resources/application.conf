# Global application settings (read by loadAppConfig via ApplicationConfig)
app {
  # Select environment section: dev | test | prod
  env = "dev"
  env = ${?APP_ENV}

  skipDb = false
  skipDb = ${?APP_SKIP_DB}

  runMigrations = true
  runMigrations = ${?APP_RUN_MIGRATIONS}
}

# Environment-specific configurations

dev {
  app {
    env = "dev"
    skipDb = ${app.skipDb}
    runMigrations = ${app.runMigrations}
  }

  server {
    port = 8080
    port = ${?SERVER_PORT}
  }

  db {
    driver = "org.postgresql.Driver"
    driver = ${?DB_DRIVER}

    url = "jdbc:postgresql://localhost:5432/kdb_url_shortener"
    url = ${?DB_URL}

    user = "kdb_url_shortener"
    user = ${?DB_USER}

    password = "kdb-url-shortener-pwd"
    password = ${?DB_PASSWORD}

    pool {
      max = 10
      max = ${?DB_POOL_MAX}
    }
  }
}

test {
  app {
    env = "test"
    skipDb = ${app.skipDb}
    runMigrations = ${app.runMigrations}
  }

  server {
    port = 8080
    port = ${?SERVER_PORT}
  }

  db {
    driver = "org.postgresql.Driver"
    driver = ${?DB_DRIVER}

    url = "jdbc:postgresql://localhost:5432/testdb"
    url = ${?DB_URL}

    user = "testuser"
    user = ${?DB_USER}

    password = "testpassword"
    password = ${?DB_PASSWORD}

    pool {
      max = 5
      max = ${?DB_POOL_MAX}
    }
  }
}

prod {
  app {
    env = "prod"
    skipDb = ${app.skipDb}
    runMigrations = ${app.runMigrations}
  }

  server {
    port = 8080
    port = ${?SERVER_PORT}
  }

  db {
    driver = "org.postgresql.Driver"
    driver = ${?DB_DRIVER}

    url = "jdbc:postgresql://db:5432/proddb"
    url = ${?DB_URL}

    user = "produser"
    user = ${?DB_USER}

    password = "prodpassword"
    password = ${?DB_PASSWORD}

    pool {
      max = 50
      max = ${?DB_POOL_MAX}
    }
  }
}

# Ktor engine (used by EngineMain)
ktor {
  deployment {
    port = 8080
    port = ${?PORT}
  }

    application {
        modules = [ dev.kotlinbr.ApplicationKt.module ]
    }
}
